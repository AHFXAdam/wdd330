var i=(n,e,t)=>new Promise((r,a)=>{var d=s=>{try{o(t.next(s))}catch(c){a(c)}},h=s=>{try{o(t.throw(s))}catch(c){a(c)}},o=s=>s.done?r(s.value):Promise.resolve(s.value).then(d,h);o((t=t.apply(n,e)).next())});import{renderList as u,getLocalStorage as l,setLocalStorage as g}from"./utils.js";export default class m{constructor(e,t,r,a=""){this.dataSource=e,this.targetElement=t,this.category=r,this.search=a}init(){return i(this,null,function*(){this.showList(),this.search==null?this.updateHeading(this.category):this.updateHeading(this.search),document.querySelector("#sort").addEventListener("click",e=>this.sortAndShow()),this.updateSortDropdown()})}updateSortDropdown(){try{const e=l("sorting");document.querySelector("#sorting").value=e}catch(e){}}sortAndShow(){this.setSorting(document.querySelector("#sorting").value),this.showList()}showList(){return i(this,null,function*(){let e=[];if(this.search==null?e=yield this.dataSource.getData(this.category):(e=yield this.getAllProducts(),e=this.filterListBySearch(e)),e=this.sortList(e),e.length==0)this.targetElement.innerHTML="Sorry, no products found matching your search.";else{const t=document.getElementById("product-card-template");this.targetElement.innerHTML="",u(t,this.targetElement,e,this.prepareTemplate)}})}getAllProducts(){return i(this,null,function*(){let e=[];const t=["tents","backpacks","sleeping-bags","hammocks"];for(let r of t){let a=yield this.dataSource.getData(r);e=[...e,...a]}return e})}sortList(e){const t=l("sorting");switch(t){case"price":e.sort((r,a)=>r.FinalPrice>a.FinalPrice?1:-1);break;case"alpha":e.sort((r,a)=>r.NameWithoutBrand>a.NameWithoutBrand?1:-1);break;case"pricedesc":e.sort((r,a)=>r.FinalPrice<a.FinalPrice?1:-1);break;case"alphadesc":e.sort((r,a)=>r.NameWithoutBrand<a.NameWithoutBrand?1:-1);break;default:break}return e}setSorting(e){g("sorting",e)}updateHeading(e){document.querySelector(".products>div>h2").innerHTML+=` ${e[0].toUpperCase()}${e.slice(1).replace("-"," ")}`}filterList(e){const t=["985RF","880RR","985PR","344YJ"],r=e.filter(a=>t.includes(a.Id));return r}filterListBySearch(e){const t=e.filter(r=>r.Name.toLowerCase().includes(this.search.toLowerCase()));return t}prepareTemplate(e,t){return e.querySelector("a").href+=t.Id,e.querySelector("img").src=t.Images.PrimaryLarge,e.querySelector("img").alt+=t.Name,e.querySelector(".card__brand").innerHTML=t.Brand.Name,e.querySelector(".card__name").innerHTML=t.NameWithoutBrand,e.querySelector(".product-card__price").innerHTML+=t.ListPrice.toFixed(2),e.querySelector(".product-card__discount_price").innerHTML+=(t.SuggestedRetailPrice-t.ListPrice).toFixed(2),e}}
