var i=(n,t,e)=>new Promise((r,a)=>{var u=s=>{try{o(e.next(s))}catch(c){a(c)}},h=s=>{try{o(e.throw(s))}catch(c){a(c)}},o=s=>s.done?r(s.value):Promise.resolve(s.value).then(u,h);o((e=e.apply(n,t)).next())});import g from"./modal.js";import{updateBreadCrumbs as d,renderList as m,getLocalStorage as l,setLocalStorage as p}from"./utils.js";export default class y{constructor(t,e,r,a=""){this.dataSource=t,this.targetElement=e,this.category=r,this.search=a}init(){return i(this,null,function*(){this.showList(),this.search==null?this.updateHeading(this.category):this.updateHeading(this.search),document.querySelector("#sort").addEventListener("click",t=>this.sortAndShow()),this.updateSortDropdown()})}updateSortDropdown(){try{const t=l("sorting");document.querySelector("#sorting").value=t}catch(t){}}sortAndShow(){this.setSorting(document.querySelector("#sorting").value),this.showList()}showList(){return i(this,null,function*(){let t=[];if(this.search==null?(t=yield this.dataSource.getData(this.category),d(`${this.category}->(${t.length} items)`)):(t=yield this.getAllProducts(),t=this.filterListBySearch(t),d(`${this.search}->(${t.length} items)`)),t=this.sortList(t),t.length==0)this.targetElement.innerHTML="Sorry, no products found matching your search.";else{const e=document.getElementById("product-card-template");this.targetElement.innerHTML="",m(e,this.targetElement,t,this.prepareTemplate)}new g})}getAllProducts(){return i(this,null,function*(){let t=[];const e=["tents","backpacks","sleeping-bags","hammocks"];for(let r of e){let a=yield this.dataSource.getData(r);t=[...t,...a]}return t})}sortList(t){const e=l("sorting");switch(e){case"price":t.sort((r,a)=>r.FinalPrice>a.FinalPrice?1:-1);break;case"alpha":t.sort((r,a)=>r.NameWithoutBrand>a.NameWithoutBrand?1:-1);break;case"pricedesc":t.sort((r,a)=>r.FinalPrice<a.FinalPrice?1:-1);break;case"alphadesc":t.sort((r,a)=>r.NameWithoutBrand<a.NameWithoutBrand?1:-1);break;default:break}return t}setSorting(t){p("sorting",t)}updateHeading(t){document.querySelector(".products>div>h2").innerHTML+=` ${t[0].toUpperCase()}${t.slice(1).replace("-"," ")}`}filterList(t){const e=["985RF","880RR","985PR","344YJ"],r=t.filter(a=>e.includes(a.Id));return r}filterListBySearch(t){const e=t.filter(r=>r.Name.toLowerCase().includes(this.search.toLowerCase()));return e}prepareTemplate(t,e){return t.querySelector("a").href+=e.Id,t.querySelector("img").src=e.Images.PrimaryLarge,t.querySelector("img").alt+=e.Name,t.querySelector(".card__brand").innerHTML=e.Brand.Name,t.querySelector(".card__name").innerHTML=e.NameWithoutBrand,t.querySelector(".product-card__price").innerHTML+=e.ListPrice.toFixed(2),t.querySelector(".product-card button").setAttribute("data-id",e.Id),t.querySelector(".product-card button").setAttribute("data-modal","modal-1"),t.querySelector(".product-card__discount_price").innerHTML+=(e.SuggestedRetailPrice-e.ListPrice).toFixed(2),t}}
