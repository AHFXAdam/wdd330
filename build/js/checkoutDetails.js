var l=(r,t,e)=>new Promise((a,o)=>{var n=c=>{try{i(e.next(c))}catch(s){o(s)}},u=c=>{try{i(e.throw(c))}catch(s){o(s)}},i=c=>c.done?a(c.value):Promise.resolve(c.value).then(n,u);i((e=e.apply(r,t)).next())});import h from"./externalServices.js";import{setLocalStorage as d,alertMessage as m,removeAllAlerts as g}from"./utils.js";function p(r){const t=new FormData(r),e={};return t.forEach(function(a,o){e[o]=a}),e}export default class S{constructor(t){this.sc=t,this.init()}init(){document.querySelector(".cart_info div span").innerHTML=this.sc.getTotalCartItems(),document.querySelector("#checkout_subtotal").innerHTML=`$${this.sc.calcTotal().toFixed(2)}`,document.querySelector("#checkout_button").addEventListener("click",t=>{t.preventDefault(),document.querySelector("form").checkValidity()?this.checkout(document.querySelector("form")):document.querySelector("form").reportValidity()}),this.ex=new h}addZipUpdate(t){t.addEventListener("change",e=>{console.log("changed zip"),document.querySelector("#checkout_shipping").innerHTML=this.calcShipping().toFixed(2),document.querySelector("#checkout_tax").innerHTML=this.calcTax().toFixed(2),document.querySelector("#checkout_total").innerHTML=this.calcFinalTotal().toFixed(2)})}calcShipping(){const t=this.sc.getTotalCartItems(),e=(t-1)*2+10;return e}calcTax(){return Math.round(this.sc.calcTotal()*6,2)/100}calcFinalTotal(){return this.sc.calcTotal()+this.calcShipping()+this.calcTax()}getLocalStorage(t){return JSON.parse(localStorage.getItem(t))}checkout(t){return l(this,null,function*(){const e=p(t);delete Object.assign(e,{cardNumber:e.card_number}).card_number,delete Object.assign(e,{fname:e.f_name}).f_name,delete Object.assign(e,{lname:e.l_name}).l_name,delete Object.assign(e,{code:e.sec_code}).sec_code,e.items=this.sc.packageItems(),e.orderTotal=this.calcFinalTotal().toFixed(2),e.shipping=this.calcShipping(),e.tax=this.calcTax(),e.orderDate=new Date;try{const a=yield this.ex.runPayment(e);d("so-cart",[]),location.assign("/checkout/checkedout.html")}catch(a){g();for(const[o,n]of Object.entries(a.message))m(n)}})}}
