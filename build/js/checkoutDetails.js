var r=(o,t,e)=>new Promise((a,n)=>{var l=c=>{try{i(e.next(c))}catch(s){n(s)}},u=c=>{try{i(e.throw(c))}catch(s){n(s)}},i=c=>c.done?a(c.value):Promise.resolve(c.value).then(l,u);i((e=e.apply(o,t)).next())});import h from"./externalServices.js";function d(o){const t=new FormData(o),e={};return t.forEach(function(a,n){e[n]=a}),e}export default class m{constructor(t){this.sc=t,this.init()}init(){document.querySelector(".cart_info div span").innerHTML=this.sc.getTotalCartItems(),document.querySelector("#checkout_subtotal").innerHTML=`$${this.sc.calcTotal().toFixed(2)}`,document.querySelector("#checkout_button").addEventListener("click",t=>{t.preventDefault(),this.checkout(document.querySelector("form"))}),this.ex=new h}addZipUpdate(t){t.addEventListener("change",e=>{console.log("changed zip"),document.querySelector("#checkout_shipping").innerHTML=this.calcShipping().toFixed(2),document.querySelector("#checkout_tax").innerHTML=this.calcTax().toFixed(2),document.querySelector("#checkout_total").innerHTML=this.calcFinalTotal().toFixed(2)})}calcShipping(){const t=this.sc.getTotalCartItems(),e=(t-1)*2+10;return e}calcTax(){return Math.round(this.sc.calcTotal()*6,2)/100}calcFinalTotal(){return this.sc.calcTotal()+this.calcShipping()+this.calcTax()}getLocalStorage(t){return JSON.parse(localStorage.getItem(t))}checkout(t){return r(this,null,function*(){console.log(t);const e=d(t);delete Object.assign(e,{cardNumber:e.card_number}).card_number,delete Object.assign(e,{fname:e.f_name}).f_name,delete Object.assign(e,{lname:e.l_name}).l_name,delete Object.assign(e,{code:e.sec_code}).sec_code,e.items=this.sc.packageItems(),e.orderTotal=this.calcFinalTotal().toFixed(2),e.shipping=this.calcShipping(),e.tax=this.calcTax(),e.orderDate=new Date,console.log(e);const a=yield this.ex.runPayment(e);console.log(a)})}}
